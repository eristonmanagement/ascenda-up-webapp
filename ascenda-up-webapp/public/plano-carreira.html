<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Plano de Carreira - Ascenda Up</title>
  <link rel="icon" type="image/png" href="/icon.png">
  <script type="module" src="firebase.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #230033;
      color: white;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 1100px;
      margin: auto;
    }
    .topbar {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    .topbar img {
      height: 40px;
    }
    .dashboard-layout {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }
    .left-box {
      flex: 1;
      min-width: 320px;
      background-color: #3c0066;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    .right-box {
      flex: 1;
      min-width: 320px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .card {
      background-color: #2d004b;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      text-align: center;
      font-family: 'Segoe UI', sans-serif;
    }
    .progress-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 6px solid #7e57c2;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      font-weight: bold;
      margin: auto;
    }
    .box-tabela {
      margin-top: 30px;
      background-color: #3c0066;
      border-radius: 12px;
      padding: 20px;
    }
    .btn-nova-acao {
      background-color: #E6E6FA;
      color: #1c0033;
      font-weight: bold;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #3c0066;
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #5e2d91;
      font-size: 0.95rem;
    }
    th {
      background-color: #4a007f;
      font-weight: bold;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #3c0066;
      padding: 20px;
      border-radius: 12px;
      width: 500px;
      max-width: 90%;
    }
    .modal-content label {
      display: block;
      margin-top: 10px;
    }
    .modal-content input,
    .modal-content textarea,
    .modal-content select {
      width: 95%;
      padding: 6px;
      margin-top: 4px;
      margin-bottom: 8px;
      border-radius: 8px;
      border: none;
      font-size: 0.95rem;
    }
    .close {
      float: right;
      font-size: 20px;
      cursor: pointer;
      color: #ccc;
    }
    .modal-content button {
      margin-top: 10px;
      padding: 8px 16px;
      background: #E6E6FA;
      color: #1c0033;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
	
	
	
	
	
.circular-chart {
  max-width: 120px;
  margin: auto;
  display: block;
}

.circle-bg {
  fill: none;
  stroke: #eee;
  stroke-width: 3.8;
}

.circle {
  fill: none;
  stroke: url(#gradient);
  stroke-width: 2.8;
  stroke-linecap: round;
  transition: stroke-dasharray 0.5s ease;
}

.percentage {
  fill: white;
  font-size: 0.4em;
  text-anchor: middle;
  dominant-baseline: middle;
}

.futuristic-gradient {
  background: linear-gradient(145deg, #34006b, #4c00a1);
  box-shadow: 0 0 15px rgba(120, 0, 255, 0.3);
}

.progress-container {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.resumo-indicadores .indicador {
  margin: 6px 0;
  font-size: 0.95rem;
  padding: 4px 10px;
  border-radius: 8px;
  width: fit-content;
}

.indicador.total {
  background-color: rgba(255, 255, 255, 0.1);
  color: #ffffff;
}

.indicador.Concluido {
  background-color: #00c85322;
  color: #00e676;
}

.indicador.Pendente {
  background-color: #ff8a6522;
  color: #ffab40;
}


.glass-panel {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  transition: transform 0.3s ease;
}

.glass-panel:hover {
  transform: scale(1.02);
}

.plano-titulo {
  font-size: 1.4rem;
  font-weight: bold;
  color: #ffb3ff;
  margin-bottom: 20px;
  line-height: 1.3;
}

.glass-panel p {
  margin: 10px 0;
  font-size: 1rem;
  color: #f0e6ff;
}

.glass-panel strong {
  color: #bb86fc;
}


.btn-top {
  background-color: transparent;
  color: #ffffff;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 6px 12px;
  font-size: 0.85rem;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.3s, color 0.3s;
}

.btn-top:hover {
  background-color: rgba(255, 255, 255, 0.1);
}



</style>


</head>
<body>

  <div class="container">
    
     <div class="topbar">
      <img src="/icon.png" alt="Ascenda Up" style="height: 40px; margin-right: 20px;" />
         <div style="flex: 1;"></div>
         <button onclick="window.location.href='Chat.html'" class="btn-top">Voltar para o Guia</button>
         <button onclick="abrirModalEditar()" class="btn-top">Editar Plano</button>
     </div>
	 
	
    <div id="app"><p>Carregando...</p></div>
  </div>

  <div class="modal" id="modalAcao">
    <div class="modal-content">
      <span class="close" onclick="fecharModal()">&times;</span>
      <h3>Nova Ação</h3>
      <label>Descrição</label><textarea id="descAcao" rows="2"></textarea>
      <label>Data Início</label><input type="date" id="inicioAcao" />
      <label>Data Término</label><input type="date" id="fimAcao" />
      <label>Status</label>
      <select id="statusAcao">
        <option value="Pendente">Pendente</option>
        <option value="Em andamento">Em andamento</option>
        <option value="Concluido">Concluído</option>
      </select>
      <label>Indicador de Sucesso</label><input type="text" id="indicadorAcao" />
      <button onclick="salvarAcao()">Salvar Ação</button>
    </div>
  </div>
  
  
 <!-- Modal atualizar Plano de Carreira -->
<div class="modal" id="modalEditar">
  <div class="modal-content">
    <span class="close" onclick="fecharModalEditar()">&times;</span>
    <h3>Editar Plano de Carreira</h3>
    <label>Título</label><input id="editTitulo">
    <label>Objetivo</label><textarea id="editObjetivo" rows="2"></textarea>
    <label>Início</label><input type="date" id="editInicio">
    <label>Conclusão</label><input type="date" id="editFim">
    <label>Área Foco</label>
    <select id="editArea">
      <option>Liderança</option>
      <option>Comunicação</option>
      <option>Gestão de Projetos</option>
      <option>Soft Skills</option>
    </select>
    <button onclick="salvarEdicaoPlano()">Salvar Alterações</button>
  </div>
</div>
  
  

  <script type="module">
    import { auth } from './firebase.js';
    import {
      getFirestore, doc, getDoc, collection, addDoc, getDocs, updateDoc
    } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

    const db = getFirestore();
    const appDiv = document.getElementById('app');
    let email = null;
    let nome = null;

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = '/login.html';
        return;
      }
      email = user.email;
      const userRef = doc(db, "usuarios", email);
      const userSnap = await getDoc(userRef);
      nome = userSnap.exists() ? userSnap.data().nome : user.email;

      const planoRef = doc(userRef, "planosDeAcao", "planoUnico");
      const snap = await getDoc(planoRef);

      if (snap.exists()) {
        const plano = snap.data();
        renderPainel(plano);
        carregarAcoes();
      } else {
        renderFormulario();
      }
    });

function renderFormulario() {
  appDiv.innerHTML = `
    <h1 style="margin-bottom: 20px;">Crie seu Plano de Carreira</h1>
    <div class="dashboard-layout">
      <div class="left-box glass-panel">
        <form id="formPlano">
          <label for="titulo">Título</label>
          <input id="titulo" required />

          <label for="objetivo">Objetivo</label>
          <textarea id="objetivo" rows="2"></textarea>

          <label for="inicio">Início</label>
          <input type="date" id="inicio" />

          <label for="fim">Conclusão</label>
          <input type="date" id="fim" />

          <label for="area">Área Foco</label>
          <select id="area">
            <option>Liderança Estratégica</option>
            <option>Gestão de Projetos e Processos</option>
            <option>Gestão de Pessoas e Equipes</option>
            <option>Especialização Técnica</option>
            <option>Carreira Internacional / Business English</option>
            <option>Transição de Carreira ou Recolocação</option>
            <option>Produtividade e Autogestão</option>
            <option>Marketing Pessoal e Networking</option>
            <option>Visão de Negócio e Mentalidade Empreendedora</option>
            <option>Planejamento de Longo Prazo (Executivo ou Técnico Sênior)</option>
          </select>

          <button type="submit" style="margin-top: 12px;">Salvar Plano</button>
        </form>
      </div>
    </div>
  `;
  document.getElementById('formPlano').addEventListener('submit', salvarPlano);
}


    async function salvarPlano(e) {
      e.preventDefault();
      const plano = {
        email,
        titulo: document.getElementById('titulo').value,
        objetivo: document.getElementById('objetivo').value,
        inicio: document.getElementById('inicio').value,
        fim: document.getElementById('fim').value,
        areaFoco: document.getElementById('area').value
      };

      await fetch("https://us-central1-ascendaup-app.cloudfunctions.net/criarOuAtualizarPlano", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(plano)
      });

      renderPainel(plano);
    }

    function renderPainel(plano) {
      planoGlobal = plano;
      appDiv.innerHTML = `
        <h1 style="margin-bottom: 12px; font-size: 2rem; font-weight: 700;">${nome}</h1>
        <div class="dashboard-layout">
            <div class="left-box glass-panel">
                 <h2 class="plano-titulo">${plano.titulo}</h2>
                 <p><strong>🎯 Objetivo:</strong> ${plano.objetivo}</p>
                 <p><strong>📅 Período:</strong> ${plano.inicio} até ${plano.fim}</p>
                 <p><strong>🧭 Área Foco:</strong> ${plano.areaFoco}</p>
            </div>

		  
		  
<div class="right-box" id="painelResumo">
  <div class="card glass-panel">
    <div class="progress-container">
      
<svg viewBox="0 0 36 36" class="circular-chart">
  <defs>
    <linearGradient id="gradient" x1="1" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#ff4d4d"/>   <!-- Vermelho -->
      <stop offset="100%" stop-color="#00e676"/> <!-- Verde -->
    </linearGradient>
  </defs>
  <path class="circle-bg"
        d="M18 2.0845
           a 15.9155 15.9155 0 0 1 0 31.831
           a 15.9155 15.9155 0 0 1 0 -31.831" />
  <path class="circle"
        id="circlePath"
        stroke-dasharray="0, 100"
        d="M18 2.0845
           a 15.9155 15.9155 0 0 1 0 31.831
           a 15.9155 15.9155 0 0 1 0 -31.831" />
  <text x="18" y="20.35" class="percentage" id="percentText">--%</text>
</svg>

	  
                 <p style="margin-top: 8px; color: #ccc; font-size: 0.9rem;">Progresso</p>
             </div>
        </div>

             <div class="card glass-panel resumo-indicadores" id="resumoTotais">
                  <div class="indicador total"><strong id="totalAcoes">--</strong> ações totais</div>
                  <div class="indicador Concluido"><strong id="concluidas">--</strong> concluídas</div>
                  <div class="indicador Pendente"><strong id="Pendentes">--</strong> Pendentes/Em andamento</div>
             </div>
         </div>
        <!---------------------------------------------------------------------------------->
		  		  
		  
        </div>
        <div class="box-tabela">
          <h3>Ações</h3>
          <button class="btn-nova-acao" onclick="abrirModal()">+ Nova Ação</button>
          <table style="margin-top: 10px;">
            <thead>
              <tr><th>Descrição</th><th>Início</th><th>Término</th><th>Status</th><th>Indicador</th></tr>
            </thead>
            <tbody id="listaAcoes"></tbody>
          </table>
        </div>
      `;
    }

    window.abrirModal = function () {
      document.getElementById("descAcao").value = "";
      document.getElementById("inicioAcao").value = "";
      document.getElementById("fimAcao").value = "";
      document.getElementById("statusAcao").value = "Pendente";
      document.getElementById("indicadorAcao").value = "";
      document.getElementById("modalAcao").style.display = "flex";
    }

    window.fecharModal = function () {
      document.getElementById("modalAcao").style.display = "none";
    }

    let idAcaoEmEdicao = null;

    window.salvarAcao = async function () {
           const acao = {
           descricao: document.getElementById("descAcao").value,
           inicio: document.getElementById("inicioAcao").value,
           fim: document.getElementById("fimAcao").value,
           status: document.getElementById("statusAcao").value,
           indicador: document.getElementById("indicadorAcao").value
        };

         if (idAcaoEmEdicao) {
              const ref = doc(db, "usuarios", email, "planosDeAcao", "planoUnico", "acoes", idAcaoEmEdicao);
              await updateDoc(ref, acao);
            } else {
           await addDoc(collection(db, "usuarios", email, "planosDeAcao", "planoUnico", "acoes"), acao);
            }

         idAcaoEmEdicao = null;
         fecharModal();
         carregarAcoes();
    };


async function carregarAcoes() {
  const tbody = document.getElementById("listaAcoes");
  tbody.innerHTML = "";
  const snap = await getDocs(collection(db, "usuarios", email, "planosDeAcao", "planoUnico", "acoes"));
  let total = 0, Concluidos = 0;

  snap.forEach(doc => {
    const acao = doc.data();
    const tr = document.createElement("tr");
	
    tr.innerHTML = `<td>${acao.descricao}</td><td>${acao.inicio}</td><td>${acao.fim}</td><td>${acao.status}</td><td>${acao.indicador}</td>`;
    tr.style.cursor = "pointer";
    tr.onclick = () => editarAcao(doc.id, acao);	
	
    tbody.appendChild(tr);

    total++;
    if (acao.status === 'Concluido') Concluidos++;
  });

  // Atualiza dashboard futurista
  if (total > 0) {
    const percentual = Math.round((Concluidos / total) * 100);

    // Atualiza o texto dentro do círculo
    const percentText = document.getElementById("percentText");
    if (percentText) percentText.textContent = percentual + "%";

    // Atualiza o traçado do SVG
    const circlePath = document.getElementById("circlePath");
    if (circlePath) circlePath.setAttribute("stroke-dasharray", `${percentual}, 100`);

    // Atualiza os indicadores com ID individual
    const totalAcoesEl = document.getElementById("totalAcoes");
    const concluidasEl = document.getElementById("concluidas");
    const PendentesEl = document.getElementById("Pendentes");

    if (totalAcoesEl) totalAcoesEl.textContent = total;
    if (concluidasEl) concluidasEl.textContent = Concluidos;
    if (PendentesEl) PendentesEl.textContent = total - Concluidos;
  }
}






let planoGlobal = null;

window.abrirModalEditar = function () {
  document.getElementById("editTitulo").value = planoGlobal.titulo;
  document.getElementById("editObjetivo").value = planoGlobal.objetivo;
  document.getElementById("editInicio").value = planoGlobal.inicio;
  document.getElementById("editFim").value = planoGlobal.fim;
  document.getElementById("editArea").value = planoGlobal.areaFoco;
  document.getElementById("modalEditar").style.display = "flex";
};

window.fecharModalEditar = function () {
  document.getElementById("modalEditar").style.display = "none";
};

window.salvarEdicaoPlano = async function () {
  const novoPlano = {
    email,
    titulo: document.getElementById('editTitulo').value,
    objetivo: document.getElementById('editObjetivo').value,
    inicio: document.getElementById('editInicio').value,
    fim: document.getElementById('editFim').value,
    areaFoco: document.getElementById('editArea').value
  };

  await fetch("https://us-central1-ascendaup-app.cloudfunctions.net/criarOuAtualizarPlano", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(novoPlano)
  });

  fecharModalEditar();
  renderPainel(novoPlano);
  carregarAcoes();          
  planoGlobal = novoPlano;

};


window.editarAcao = function (id, acao) {
  idAcaoEmEdicao = id;
  document.getElementById("descAcao").value = acao.descricao;
  document.getElementById("inicioAcao").value = acao.inicio;
  document.getElementById("fimAcao").value = acao.fim;
  document.getElementById("statusAcao").value = acao.status;
  document.getElementById("indicadorAcao").value = acao.indicador;
  document.getElementById("modalAcao").style.display = "flex";
};


  </script>
</body>
</html>
